const content = {
    "zh-TW": {
        pageTitle: "MONSTER HUNTER WILDS | 伺服器努力工作中",
        mainTitle: "獵人眾多，伺服器努力工作中！",
        mainMessage: "各位獵人，感謝您的耐心！我們的伺服器正在全力處理湧入的請求。",
        statusTitle: "目前情況",
        statusText: "我們正在密切監控伺服器負載，並調配更多資源。預計很快能恢復部分服務，請各位獵人稍後再嘗試。",
        timerText: "建議刷新時間：",
        autoRefreshLabel: "倒數結束自動刷新",
        reassuranceTitle: "請您放心",
        reassuranceText: "若您剛才正在進行購買或重要操作，請不用擔心。系統設計有保護機制，您的交易資料是安全的。一旦服務恢復，您可以檢查您的訂單狀態或聯繫客服確認。",
        waitTitle: "等待時，您可以...",
        waitOpt1: "觀看下方的最新遊戲預告片。",
        waitOpt2: "前往 <a href='https://www.monsterhunter.com/wilds/zh-hant/' target='_blank' id='official-site-link-wait'>官方網站</a> 查閱最新消息。",
        waitOpt3: "在社群媒體上看看其他獵人的討論。",
        homeButton: "回首頁",
        refreshButton: "立即刷新",
        socialText: "追蹤我們以獲取即時更新：",
        videoOverlayText: "《Street Fighter 6》特別合作登場！",
        youtubeId: "vlAm9kHEJ2s",
        triviaTitle: "狩獵小知識： ",
        triviaTips: [
            "你知道回復藥G怎麼合成嗎？回復藥 + 蜂蜜！",
            "閃光彈對飛行中的火龍非常有效！",
            "用餐時選擇貓飯技能，能讓狩獵更順利喔！",
            "別忘了磨刀！武器的銳利度會影響傷害。",
            "遇到轟龍？牠的火車非常危險，注意閃避！",
            "當兩隻魔物出現在同一區域時，一顆適時的「異臭彈」或許能幫您擺脫混戰的困境！",
            "環境生物遍佈在各地圖中，有些能提供暫時的能力加成，有些則能當作投射物使用！"
        ],
        queueMessage: "排隊進度：前方約有 {hunters} 位獵人，請耐心等候。",
        queueStatusInProgress: "系統正在努力為您安排位置..."
    },
    "en": {
        pageTitle: "MONSTER HUNTER WILDS | Servers Working Hard",
        mainTitle: "Many Hunters Online! Servers are Working Hard!",
        mainMessage: "Hunters, thank you for your patience! Our servers are currently processing a high volume of requests.",
        statusTitle: "Current Status",
        statusText: "We are closely monitoring server load and allocating more resources. We expect services to resume shortly. Please try again in a bit.",
        timerText: "Suggested refresh in: ",
        autoRefreshLabel: "Auto-refresh when countdown ends",
        reassuranceTitle: "Rest Assured",
        reassuranceText: "If you were in the middle of a purchase or important action, please don't worry. Our system has safeguards, and your transaction data is secure. Once services are restored, please check your order status or contact support.",
        waitTitle: "While You Wait, You Can...",
        waitOpt1: "Watch the latest game trailer below.",
        waitOpt2: "Visit the <a href='https://www.monsterhunter.com/wilds/en-us/' target='_blank' id='official-site-link-wait'>official website</a> for the latest news.",
        waitOpt3: "Check out discussions from other hunters on social media.",
        homeButton: "Home",
        refreshButton: "Refresh Now",
        socialText: "Follow us for live updates:",
        videoOverlayText: "Street Fighter 6 Special Collaboration Event!",
        youtubeId: "vlAm9kHEJ2s",
        triviaTitle: "Hunting Tip: ",
        triviaTips: [
            "Did you know Mega Potion is crafted from Potion + Honey?",
            "Flash Bombs are very effective against flying Rathalos!",
            "Choose your Canteen skills wisely before a hunt!",
            "Don't forget to sharpen your weapon! Sharpness affects damage.",
            "Facing a Tigrex? Its charge is dangerous, be careful to dodge!",
            "When two monsters are in the same area, a well-timed Dung Bomb can help you escape a chaotic brawl!",
            "Endemic Life is found all over the maps; some grant temporary buffs, while others can be used as projectiles!"
        ],
        queueMessage: "Queue Progress: Approximately {hunters} hunters ahead of you. Please wait patiently.",
        queueStatusInProgress: "System is working hard to find you a spot..."
    },
    "ja": {
        pageTitle: "MONSTER HUNTER WILDS | サーバー対応中",
        mainTitle: "ハンター多数接続中！サーバーが対応作業中です！",
        mainMessage: "ハンターの皆様、しばらくお待ちいただきありがとうございます！現在、サーバーが大量のリクエストを処理中です。",
        statusTitle: "現在の状況",
        statusText: "サーバーの負荷を注視し、リソースを増強中です。間もなく一部サービスが復旧する見込みです。ハンターの皆様は、しばらくしてから再度お試しください。",
        timerText: "推奨リフレッシュ時間：",
        autoRefreshLabel: "カウントダウン終了後に自動更新",
        reassuranceTitle: "ご安心ください",
        reassuranceText: "購入手続きや重要な操作の最中だった場合でもご安心ください。システムには保護機能があり、お客様の取引データは安全です。サービス復旧後、注文状況をご確認いただくか、サポートまでお問い合わせください。",
        waitTitle: "お待ちの間、こちらをご覧ください...",
        waitOpt1: "下の最新ゲームトレーラーをご覧ください。",
        waitOpt2: "<a href='https://www.monsterhunter.com/wilds/ja-jp/' target='_blank' id='official-site-link-wait'>公式サイト</a>で最新情報をご確認ください。",
        waitOpt3: "ソーシャルメディアで他のハンターの議論をチェックしましょう。",
        homeButton: "ホームへ",
        refreshButton: "今すぐ更新",
        socialText: "リアルタイムの更新情報をフォローしてください：",
        videoOverlayText: "『ストリートファイター6』スペシャルコラボ開催！",
        youtubeId: "vlAm9kHEJ2s",
        triviaTitle: "狩りの豆知識： ",
        triviaTips: [
            "グレート回復薬の調合方法を知っていますか？ 回復薬＋ハチミツですよ！",
            "閃光玉は飛行中のリオレウスに非常に効果的です！",
            "食事スキルを選んで、狩りを有利に進めましょう！",
            "武器の研磨を忘れずに！斬れ味はダメージに影響します。",
            "ティガレックスに遭遇？突進は非常に危険なので、回避に注意！",
            "2体のモンスターが同じエリアに現れた時、タイミング良く「こやし玉」を使えば、混戦を避けられるかもしれません！",
            "環境生物は各マップの至る所にいます。一時的な能力強化を得られるものや、投射物として使えるものもいます！"
        ],
        queueMessage: "待機列の状況：前方には約 {hunters} 人のハンターがいます。しばらくお待ちください。",
        queueStatusInProgress: "システムが空き状況を確認しています..."
    }
};

let countdownInterval;
let triviaInterval;
let currentTriviaIndex = 0;
let simulatedQueueInterval;

function startCountdown(duration, display) {
    let timer = duration, seconds;
    clearInterval(countdownInterval);
    countdownInterval = setInterval(function () {
        seconds = parseInt(timer % 60, 10);
        display.textContent = seconds < 10 ? "0" + seconds : seconds;
        if (--timer < 0) {
            display.textContent = "00";
            clearInterval(countdownInterval);
            const autoRefresh = document.getElementById("auto-refresh-toggle");
            if (autoRefresh && autoRefresh.checked) {
                location.reload();
            }
        }
    }, 1000);
}

function startTriviaProgressBar(durationMs = 7000) {
    const bar = document.getElementById('trivia-progress-inner');
    if (bar) {
        bar.style.transition = 'none';
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.transition = `width ${durationMs}ms linear`;
            bar.style.width = '100%';
        }, 20);
    }
}

function updateTrivia() {
    const lang = document.getElementById("language-select").value;
    const currentLangContent = content[lang];
    const triviaElement = document.getElementById("mh-trivia");
    const triviaTitleElement = document.getElementById("trivia-title");

    if (triviaElement && triviaTitleElement && currentLangContent.triviaTips && currentLangContent.triviaTips.length > 0) {
        triviaTitleElement.textContent = currentLangContent.triviaTitle;
        currentTriviaIndex = (currentTriviaIndex + 1) % currentLangContent.triviaTips.length;
        triviaElement.textContent = currentLangContent.triviaTips[currentTriviaIndex];
    }
    startTriviaProgressBar();
}

function resetTriviaCycle() {
    clearInterval(triviaInterval);
    currentTriviaIndex = -1;
    updateTrivia();
    startTriviaProgressBar();
    triviaInterval = setInterval(() => {
        updateTrivia();
        startTriviaProgressBar();
    }, 7000);
}

function updateSimulatedQueueMessage() {
    const lang = document.getElementById("language-select").value;
    const currentLangContent = content[lang];
    const queueMessageElement = document.getElementById("queue-message");

    if (queueMessageElement && currentLangContent.queueMessage) {
        let numHunters;
        if (Math.random() < 0.7) {
            numHunters = Math.floor(Math.random() * 150) + 50;
            queueMessageElement.textContent = currentLangContent.queueMessage.replace("{hunters}", numHunters);
        } else {
            queueMessageElement.textContent = currentLangContent.queueStatusInProgress;
        }
    }
}

function resetSimulatedQueueCycle() {
    clearInterval(simulatedQueueInterval);
    updateSimulatedQueueMessage(); // Update immediately
    simulatedQueueInterval = setInterval(updateSimulatedQueueMessage, 5000);
}


function changeLanguage() {
    const lang = document.getElementById("language-select").value;
    const currentContent = content[lang];
    const container = document.getElementById("content-container");

    document.title = currentContent.pageTitle;
    container.querySelector("#main-title").innerHTML = currentContent.mainTitle;
    container.querySelector("#main-message").innerHTML = currentContent.mainMessage;

    container.querySelector("#status-title").innerHTML = currentContent.statusTitle;
    container.querySelector("#status-text").innerHTML = currentContent.statusText;
    const videoOverlayTextElement = document.getElementById("video-overlay-text-content");
    if (videoOverlayTextElement) {
        videoOverlayTextElement.textContent = currentContent.videoOverlayText;

        if (lang === 'en') {
            videoOverlayTextElement.style.fontFamily = '\'Markazi Text\', "source-han-serif-japanese", serif';
        } else {
            videoOverlayTextElement.style.fontFamily = '';
        }
    }

    const countdownTextEl = container.querySelector("#timer-text");
    const countdownSpan = countdownTextEl.querySelector("#countdown") || document.createElement('span');
    countdownSpan.id = 'countdown'; // Ensure it has an ID if newly created
    countdownTextEl.textContent = currentContent.timerText; // Set text before appending span
    countdownTextEl.appendChild(countdownSpan); // Append span
    startCountdown(60, countdownSpan); // Start countdown

    container.querySelector("#reassurance-title").innerHTML = currentContent.reassuranceTitle;
    container.querySelector("#reassurance-text").innerHTML = currentContent.reassuranceText;

    container.querySelector("#wait-title").innerHTML = currentContent.waitTitle;
    container.querySelector("#wait-opt1").innerHTML = currentContent.waitOpt1;
    const waitOpt2Link = container.querySelector("#wait-opt2");
    waitOpt2Link.innerHTML = currentContent.waitOpt2;

    document.getElementById("auto_refresh").textContent = currentContent.autoRefreshLabel;

    container.querySelector("#wait-opt3").innerHTML = currentContent.waitOpt3;

    container.querySelector("#home-button").textContent = currentContent.homeButton;
    container.querySelector("#refresh-button").textContent = currentContent.refreshButton;
    container.querySelector("#social-text").innerHTML = currentContent.socialText;

    document.getElementById("video-overlay-text-content").textContent = currentContent.videoOverlayText;

    const logoLink = document.querySelector(".logo-link");
    const homeButtonLink = container.querySelector("#home-button");
    let officialSiteUrl = 'https://www.monsterhunter.com/wilds/zh-hant/';
    if (lang === 'en') officialSiteUrl = 'https://www.monsterhunter.com/wilds/en-us/';
    if (lang === 'ja') officialSiteUrl = 'https://www.monsterhunter.com/wilds/ja-jp/';

    logoLink.href = officialSiteUrl;
    homeButtonLink.href = officialSiteUrl;

    const youtubePlayer = document.getElementById("youtube-player");
    if (youtubePlayer) {
        youtubePlayer.src = `https://www.youtube.com/embed/$${currentContent.youtubeId}?autoplay=0&mute=1&hl=${lang}&loop=1&playlist=${currentContent.youtubeId}`;
    }


    container.className = "container";
    if (lang === "en" || lang === "ja") {
        container.classList.add(lang);
    }

    resetTriviaCycle();
    resetSimulatedQueueCycle();
}

document.addEventListener('DOMContentLoaded', function() {
    const userLang = navigator.language || navigator.userLanguage;
    const selectElement = document.getElementById("language-select");
    if (userLang.startsWith("en")) {
        selectElement.value = "en";
    } else if (userLang.startsWith("ja")) {
        selectElement.value = "ja";
    } else {
        selectElement.value = "zh-TW";
    }
    changeLanguage();
});


